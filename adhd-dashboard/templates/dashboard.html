{% extends "base.html" %}
{% block title %}ğŸ§  Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ù†{% endblock %}

{% block content %}
<!-- Ù‡Ø¯Ø± -->
<div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
    <div>
        <h1 class="text-2xl font-bold text-gray-800">ğŸ§  Ù…Ø±Ú©Ø² ÙØ±Ù…Ø§Ù†Ø¯Ù‡ÛŒ</h1>
        <p class="text-gray-500">Ø³Ù„Ø§Ù… {{ user_name }}! Ø§Ù…Ø±ÙˆØ² {{ today_weekday }}ØŒ {{ today }}</p>
    </div>
    
    {% if not notion_configured %}
    <div class="bg-yellow-50 border border-yellow-200 text-yellow-700 px-4 py-2 rounded-xl text-sm">
        âš ï¸ Notion ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡ - <a href="{{ url_for('settings_page') }}" class="underline">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</a>
    </div>
    {% endif %}
</div>

<!-- Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
    <!-- Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡ Ø§Ù…Ø±ÙˆØ² -->
    <div class="card text-center">
        <div class="text-3xl font-bold text-green-500">{{ stats.get('done_today', 0) }}</div>
        <div class="text-sm text-gray-500">âœ… Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡ Ø§Ù…Ø±ÙˆØ²</div>
    </div>
    
    <!-- Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± -->
    <div class="card text-center">
        <div class="text-3xl font-bold text-blue-500">{{ stats.get('pending', 0) }}</div>
        <div class="text-sm text-gray-500">â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
    </div>
    
    <!-- Ú©Ø§Ø±Ù‡Ø§ÛŒ ÙÙˆØ±ÛŒ -->
    <div class="card text-center">
        <div class="text-3xl font-bold text-red-500">{{ stats.get('urgent', 0) }}</div>
        <div class="text-sm text-gray-500">ğŸš¨ ÙÙˆØ±ÛŒ</div>
    </div>
    
    <!-- Streak Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ -->
    <div class="card text-center">
        <div class="text-3xl font-bold text-purple-500">{{ habit_stats.get('longest_streak', 0) }}</div>
        <div class="text-sm text-gray-500">ğŸ”¥ Ø¨Ù‡ØªØ±ÛŒÙ† Streak</div>
    </div>
</div>

<!-- Ø¯Ùˆ Ø³ØªÙˆÙ†Ù‡: ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒâ€ŒÙ‡Ø§ Ùˆ Mood -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
    <!-- ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒâ€ŒÙ‡Ø§ÛŒ ÙÙˆØ±ÛŒ -->
    <div class="card">
        <h2 class="card-title">ğŸ”” ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒâ€ŒÙ‡Ø§ÛŒ ÙÙˆØ±ÛŒ</h2>
        {% if reminders %}
        <ul class="mt-4 space-y-2">
            {% for task in reminders %}
            <li class="flex items-center gap-2 p-2 bg-red-50 rounded-lg text-sm">
                <span class="text-red-500">ğŸš¨</span>
                <span class="flex-1 truncate">{{ task.title }}</span>
                {% if task.due_date %}
                <span class="text-xs text-gray-400">{{ task.due_date }}</span>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <div class="mt-4 text-center text-gray-400 py-4">
            <div class="text-3xl mb-2">ğŸ‰</div>
            <div>Ú©Ø§Ø± ÙÙˆØ±ÛŒ Ù†Ø¯Ø§Ø±ÛŒ!</div>
        </div>
        {% endif %}
    </div>
    
    <!-- ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆØ­ÛŒ -->
    <div class="card">
        <h2 class="card-title">ğŸ˜Š ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆØ­ÛŒ</h2>
        {% if sheets_configured and sheets_summary %}
        <div class="mt-4 grid grid-cols-2 gap-4">
            <div class="text-center p-3 bg-purple-50 rounded-xl">
                <div class="text-2xl font-bold text-purple-500">{{ sheets_summary.get('avg_mood', '-') }}</div>
                <div class="text-xs text-gray-500">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Mood</div>
            </div>
            <div class="text-center p-3 bg-blue-50 rounded-xl">
                <div class="text-2xl font-bold text-blue-500">{{ sheets_summary.get('avg_energy', '-') }}</div>
                <div class="text-xs text-gray-500">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Energy</div>
            </div>
        </div>
        <div class="mt-3 text-center text-sm">
            <span class="{% if sheets_summary.get('trend') == 'improving' %}text-green-500
                        {% elif sheets_summary.get('trend') == 'declining' %}text-red-500
                        {% else %}text-gray-500{% endif %}">
                {% if sheets_summary.get('trend') == 'improving' %}ğŸ“ˆ Ø±Ùˆ Ø¨Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯
                {% elif sheets_summary.get('trend') == 'declining' %}ğŸ“‰ Ø±Ùˆ Ø¨Ù‡ Ú©Ø§Ù‡Ø´
                {% else %}â¡ï¸ Ø«Ø§Ø¨Øª{% endif %}
            </span>
            <span class="text-gray-400 mr-2">({{ sheets_summary.get('days_tracked', 0) }} Ø±ÙˆØ²)</span>
        </div>
        {% else %}
        <div class="mt-4 text-center text-gray-400 py-4">
            <p>Google Sheets ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡</p>
            <a href="{{ url_for('settings_page') }}" class="text-primary text-sm underline">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</a>
        </div>
        {% endif %}
    </div>
</div>

<!-- Ù…Ø§ØªØ±ÛŒØ³ Ø¢ÛŒØ²Ù†Ù‡Ø§ÙˆØ± -->
<div class="card mb-6">
    <div class="flex items-center justify-between mb-4">
        <h2 class="card-title">ğŸ”¥ Ù…Ø§ØªØ±ÛŒØ³ Ø¢ÛŒØ²Ù†Ù‡Ø§ÙˆØ±</h2>
        <a href="{{ url_for('tasks_page') }}" class="text-sm text-primary hover:underline">
            Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡ â†’
        </a>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Q1: Ø¨Ø­Ø±Ø§Ù† -->
        <div class="quadrant q1-bg rounded-xl p-4">
            <div class="flex items-center gap-2 mb-3">
                <span class="w-8 h-8 rounded-lg bg-q1 text-white flex items-center justify-center font-bold">1</span>
                <div>
                    <h3 class="font-bold text-q1">Ø¨Ø­Ø±Ø§Ù†â€ŒÙ‡Ø§</h3>
                    <p class="text-xs text-gray-500">Ù…Ù‡Ù… + ÙÙˆØ±ÛŒ â†’ Ø§Ù†Ø¬Ø§Ù… Ø¨Ø¯Ù‡!</p>
                </div>
            </div>
            <div class="space-y-2">
                {% for task in quadrants[1] %}
                <div class="task-card" data-id="{{ task.id }}">
                    <div class="flex items-center gap-2">
                        <button onclick="markDone('{{ task.id }}')" class="task-checkbox">âœ“</button>
                        <span class="flex-1 truncate">{{ task.title }}</span>
                    </div>
                </div>
                {% else %}
                <div class="text-center text-gray-400 py-4 text-sm">Ø®Ø§Ù„ÛŒ ğŸ¯</div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Q2: Ø°Ú©Ø§ÙˆØª -->
        <div class="quadrant q2-bg rounded-xl p-4">
            <div class="flex items-center gap-2 mb-3">
                <span class="w-8 h-8 rounded-lg bg-q2 text-white flex items-center justify-center font-bold">2</span>
                <div>
                    <h3 class="font-bold text-q2">Ø§Ù‡Ø¯Ø§Ù Ùˆ Ø±Ø´Ø¯</h3>
                    <p class="text-xs text-gray-500">Ù…Ù‡Ù… + ØºÛŒØ±ÙÙˆØ±ÛŒ â†’ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ú©Ù†</p>
                </div>
            </div>
            <div class="space-y-2">
                {% for task in quadrants[2] %}
                <div class="task-card" data-id="{{ task.id }}">
                    <div class="flex items-center gap-2">
                        <button onclick="markDone('{{ task.id }}')" class="task-checkbox">âœ“</button>
                        <span class="flex-1 truncate">{{ task.title }}</span>
                    </div>
                </div>
                {% else %}
                <div class="text-center text-gray-400 py-4 text-sm">Ø®Ø§Ù„ÛŒ ğŸŒ±</div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Q3: Ø­ÙˆØ§Ø³â€ŒÙ¾Ø±ØªÛŒ -->
        <div class="quadrant q3-bg rounded-xl p-4">
            <div class="flex items-center gap-2 mb-3">
                <span class="w-8 h-8 rounded-lg bg-q3 text-white flex items-center justify-center font-bold">3</span>
                <div>
                    <h3 class="font-bold text-q3">Ù…Ø²Ø§Ø­Ù…Øªâ€ŒÙ‡Ø§</h3>
                    <p class="text-xs text-gray-500">ØºÛŒØ±Ù…Ù‡Ù… + ÙÙˆØ±ÛŒ â†’ Ù…Ø­ÙˆÙ„ Ú©Ù†</p>
                </div>
            </div>
            <div class="space-y-2">
                {% for task in quadrants[3] %}
                <div class="task-card" data-id="{{ task.id }}">
                    <div class="flex items-center gap-2">
                        <button onclick="markDone('{{ task.id }}')" class="task-checkbox">âœ“</button>
                        <span class="flex-1 truncate">{{ task.title }}</span>
                    </div>
                </div>
                {% else %}
                <div class="text-center text-gray-400 py-4 text-sm">Ø®Ø§Ù„ÛŒ ğŸ‘</div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Q4: Ø§ØªÙ„Ø§Ù -->
        <div class="quadrant q4-bg rounded-xl p-4">
            <div class="flex items-center gap-2 mb-3">
                <span class="w-8 h-8 rounded-lg bg-q4 text-white flex items-center justify-center font-bold">4</span>
                <div>
                    <h3 class="font-bold text-q4">Ø­ÙˆØ§Ø³â€ŒÙ¾Ø±ØªÛŒâ€ŒÙ‡Ø§</h3>
                    <p class="text-xs text-gray-500">ØºÛŒØ±Ù…Ù‡Ù… + ØºÛŒØ±ÙÙˆØ±ÛŒ â†’ Ø­Ø°Ù Ú©Ù†</p>
                </div>
            </div>
            <div class="space-y-2">
                {% for task in quadrants[4] %}
                <div class="task-card" data-id="{{ task.id }}">
                    <div class="flex items-center gap-2">
                        <button onclick="deleteTask('{{ task.id }}')" class="text-gray-400 hover:text-red-500">Ã—</button>
                        <span class="flex-1 truncate text-gray-500">{{ task.title }}</span>
                    </div>
                </div>
                {% else %}
                <div class="text-center text-gray-400 py-4 text-sm">Ø®Ø§Ù„ÛŒ âœ¨</div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Ø¯Ø³ØªØ±Ø³ÛŒ Ø³Ø±ÛŒØ¹ -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <!-- High Focus -->
    <div class="card">
        <h2 class="card-title">ğŸ”¥ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙ…Ø±Ú©Ø² Ø¨Ø§Ù„Ø§</h2>
        {% if high_focus %}
        <ul class="mt-3 space-y-2">
            {% for task in high_focus %}
            <li class="flex items-center gap-2 p-2 bg-red-50 rounded-lg text-sm">
                <span>ğŸ”¥</span>
                <span class="truncate">{{ task.title }}</span>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <div class="text-center text-gray-400 py-6 text-sm">Ú©Ø§Ø±ÛŒ Ù†ÛŒØ³Øª</div>
        {% endif %}
    </div>
    
    <!-- Quick Wins -->
    <div class="card">
        <h2 class="card-title">âš¡ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø³Ø±ÛŒØ¹</h2>
        {% if quick_wins %}
        <ul class="mt-3 space-y-2">
            {% for task in quick_wins %}
            <li class="flex items-center gap-2 p-2 bg-yellow-50 rounded-lg text-sm">
                <span>âš¡</span>
                <span class="truncate">{{ task.title }}</span>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <div class="text-center text-gray-400 py-6 text-sm">Ú©Ø§Ø±ÛŒ Ù†ÛŒØ³Øª</div>
        {% endif %}
    </div>
    
    <!-- Low Energy -->
    <div class="card">
        <h2 class="card-title">ğŸª¶ ÙˆÙ‚ØªÛŒ Ø®Ø³ØªÙ‡â€ŒØ§ÛŒ</h2>
        {% if low_energy %}
        <ul class="mt-3 space-y-2">
            {% for task in low_energy %}
            <li class="flex items-center gap-2 p-2 bg-blue-50 rounded-lg text-sm">
                <span>ğŸª¶</span>
                <span class="truncate">{{ task.title }}</span>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <div class="text-center text-gray-400 py-6 text-sm">Ú©Ø§Ø±ÛŒ Ù†ÛŒØ³Øª</div>
        {% endif %}
    </div>
</div>

<!-- Ø¢Ù…Ø§Ø± Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ -->
{% if habit_stats %}
<div class="card">
    <div class="flex items-center justify-between mb-4">
        <h2 class="card-title">ğŸ¯ Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§</h2>
        <a href="{{ url_for('habits_page') }}" class="text-sm text-primary hover:underline">
            Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡ â†’
        </a>
    </div>
    
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="text-center p-3 bg-green-50 rounded-xl">
            <div class="text-2xl font-bold text-good">{{ habit_stats.get('good_count', 0) }}</div>
            <div class="text-xs text-gray-500">ğŸŸ¢ Ø¹Ø§Ø¯Øª Ø®ÙˆØ¨</div>
        </div>
        <div class="text-center p-3 bg-red-50 rounded-xl">
            <div class="text-2xl font-bold text-bad">{{ habit_stats.get('bad_count', 0) }}</div>
            <div class="text-xs text-gray-500">ğŸ”´ Ø¹Ø§Ø¯Øª Ø¨Ø¯</div>
        </div>
        <div class="text-center p-3 bg-blue-50 rounded-xl">
            <div class="text-2xl font-bold text-blue-500">{{ habit_stats.get('active', 0) }}</div>
            <div class="text-xs text-gray-500">ğŸ¯ ÙØ¹Ø§Ù„</div>
        </div>
        <div class="text-center p-3 bg-purple-50 rounded-xl">
            <div class="text-2xl font-bold text-purple-500">{{ habit_stats.get('achieved', 0) }}</div>
            <div class="text-xs text-gray-500">âœ… Ù…ÙˆÙÙ‚ Ø´Ø¯Ù‡</div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
async function markDone(taskId) {
    try {
        const response = await fetch(`/api/tasks/${taskId}/done`, { method: 'POST' });
        const result = await response.json();
        
        if (result.success) {
            showToast('Ø¢ÙØ±ÛŒÙ†! âœ…', 'success');
            const taskEl = document.querySelector(`[data-id="${taskId}"]`);
            if (taskEl) {
                taskEl.classList.add('opacity-50', 'line-through');
                setTimeout(() => taskEl.remove(), 500);
            }
        }
    } catch (error) {
        showToast('Ø®Ø·Ø§', 'error');
    }
}

async function deleteTask(taskId) {
    if (!confirm('Ø­Ø°Ù Ø´ÙˆØ¯ØŸ')) return;
    
    try {
        const response = await fetch(`/api/tasks/${taskId}`, { method: 'DELETE' });
        const result = await response.json();
        
        if (result.success) {
            showToast('Ø­Ø°Ù Ø´Ø¯', 'success');
            document.querySelector(`[data-id="${taskId}"]`)?.remove();
        }
    } catch (error) {
        showToast('Ø®Ø·Ø§', 'error');
    }
}
</script>
{% endblock %}
